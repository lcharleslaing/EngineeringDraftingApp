{% load process_filters %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Process Print</title>
  <link href="https://cdn.tailwindcss.com" rel="preload" as="style" onload="this.rel='stylesheet'">
  <style>
    .img-print{max-width:100%;width:100%;height:auto;page-break-inside:avoid;break-inside:avoid;}
    .img-grid{display:grid;grid-template-columns:1fr;gap:0.5rem;}
    @media (min-width:768px){ .img-grid{grid-template-columns:1fr;} }
    @media print{ .img-grid{grid-template-columns:1fr;} }
    .formatted-text {
      white-space: pre-line;
      font-family: Arial, sans-serif;
      line-height: 1.3;
      margin: 0;
    }
    .formatted-text h1, .formatted-text h2, .formatted-text h3 {
      font-weight: bold;
      margin: 8px 0 4px 0;
    }
    .formatted-text h1 { font-size: 16px; }
    .formatted-text h2 { font-size: 14px; }
    .formatted-text h3 { font-size: 13px; }
    .formatted-text ul, .formatted-text ol {
      margin: 4px 0;
      padding-left: 20px;
    }
    .formatted-text li {
      margin: 2px 0;
      line-height: 1.3;
    }
    .formatted-text strong {
      font-weight: bold;
    }
    .formatted-text em {
      font-style: italic;
    }
    .formatted-text p {
      margin: 4px 0;
      line-height: 1.3;
    }
  </style>
</head>
<body class="p-8">
  {% for p in processes %}
    <section class="mb-10 break-inside-avoid">
      <h1 class="text-3xl font-bold mb-2">{{ p.name }}</h1>
      {% if p.summary %}
        <div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-400">
          <h2 class="text-xl font-semibold mb-2">Summary</h2>
          <div class="formatted-text">{{ p.summary|markdown_to_html|safe }}</div>
        </div>
      {% endif %}
      {% if p.description %}<p class="mb-4">{{ p.description|linebreaksbr }}</p>{% endif %}
      <ol class="list-decimal ml-6 space-y-2">
        {% for step in p.steps.all %}
          <li>
            <div class="font-semibold">{{ step.title }}</div>
            {% if step.details %}<div class="opacity-80">{{ step.details|linebreaksbr }}</div>{% endif %}
            {% if step.images.all %}
              <div class="img-grid mt-2">
                {% for img in step.images.all %}
                  <img src="{{ img.image.url }}" class="rounded border img-print" />
                {% endfor %}
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ol>
      {% if p.notes %}<h2 class="text-xl font-semibold mt-6">Notes</h2><p>{{ p.notes|linebreaksbr }}</p>{% endif %}
      {% if p.analysis %}
        <div class="mt-6 p-4 bg-green-50 border-l-4 border-green-400">
          <h2 class="text-xl font-semibold mb-2">Process Analysis</h2>
          <div class="formatted-text">{{ p.analysis|markdown_to_html|safe }}</div>
        </div>
      {% endif %}
    </section>
  {% endfor %}
  <script>window.print()</script>
</body>
</html>


